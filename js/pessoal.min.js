$(document).ready(function(){function n(a,b,g,k,e){return"int"!==b||Number.isInteger(a)?"float"===b&&isNaN(a)?(alert("O valor de "+e+" precisa ser um n\u00famero"),-1):a<g||a>k?(alert("O valor de "+e+" precisa ser um n\u00famero entre "+g+" e "+k),-1):1:(alert("O valor de "+e+" precisa ser um n\u00famero inteiro"),-1)}function z(a,b,g,k){var e=$("#tabelaCargaHoraria");e.append("<tbody>");for(var l=1;l<a+1;l++){e.append("<tr><td id='linhaDia"+l+"'>Dia "+l+"</td></tr>");for(var c=b;0<c;c--){$("#linhaDia"+
l).after("<td id='linhaTurno"+l+c+"'></td>");for(var d=1;d<g+1;d++)$("#linhaTurno"+l+c).append("<input type='text' class='smallinput inputUsuario form-control' maxlength='"+k+"' id='"+l+"-"+c+"-"+d+"'>")}}e.append("</tbody>")}function A(a){aux=$("#tabelaCargaOperadores");aux.append("<tbody>");a.forEach(function(b){aux.append("<tr id='linhaTabelaCargaOperadores-"+b+"'><td>"+b+"</td><td><span id='operador"+b+"-cargaHoraria'></span></td><td><span id='operador"+b+"-etapaComum'></span></td><td><span id='operador"+
b+"-etapaEventual'></span></td></tr>")});aux.append("</tbody>")}function B(a,b){inputProponente=$("#inputProponente");inputProposto=$("#inputProposto");inputDiaProponente=$("#inputDiaProponente");inputDiaProposto=$("#inputDiaProposto");a.forEach(function(b){inputProponente.append("<option value='"+b+"'>"+b+"</option>");inputProposto.append("<option value='"+b+"'>"+b+"</option>")});for(var g=1;g<=b;g++)inputDiaProponente.append("<option value='"+g+"'>"+g+"</option>"),inputDiaProposto.append("<option value='"+
g+"'>"+g+"</option>")}function u(a,b,g,k,e,l,c){this.proponente=a;this.proposto=b;this.diaProponente=g;this.diaProposto=k;this.turnoProponente=e;this.turnoProposto=l;this.dataRegistro=c}function v(a,b,g){this.cargaHoraria=a;this.etapasComuns=b;this.etapasEventuais=g}function w(a){a.forEach(function(b){f[b]=new v(0,[],[])})}function q(a){a.forEach(function(b){f[b].cargaHoraria=0;f[b].etapasComuns=[];f[b].etapasEventuais=[]})}function r(a,b,g,k){for(var e=1;e<=b;e++){m[e]=[];for(var l=1;l<=g;l++){m[e][l]=
[];for(var c=1;c<=k;c++){valorCelula=$("#"+e+"-"+l+"-"+c).val();indiceValorCelula=a.indexOf(valorCelula);if(-1==indiceValorCelula)if(""===valorCelula)continue;else return alert("Voc\u00ea inseriu um usu\u00e1rio n\u00e3o cadastrado no dia "+e),$("#linhaTurno"+e+l).addClass("danger"),-1;m[e][l][c]=valorCelula}}}return 1}function x(a,b,g){a.forEach(function(a){var e;e=f[a].etapasComuns.length*b;e+=f[a].etapasEventuais.length*g;0>e&&alert("Aconteceu algum problema inesperado na contagem de carga do operador "+
a+". Contacte o Schuler e pare de utilizar o programa enquanto o problema n\u00e3o for resolvido.");f[a].cargaHoraria=e})}function y(a){a.forEach(function(b){for(var a,k=0;k<f[b].etapasEventuais.length;k++)a=f[b].etapasComuns.indexOf(f[b].etapasEventuais[k]),-1!=a&&f[b].etapasComuns.splice(a,1)})}function C(a,b,g,k){a.forEach(function(a){for(var e=1;e<=b;e++)for(var c=1;c<=g;c++)for(var d=1;d<=k;d++)valorCelula=m[e][c][d],""!==valorCelula&&valorCelula==a&&(1!=c&&2!=c||f[a].etapasComuns.push(e),3==
c&&f[a].etapasEventuais.push(e))})}function t(a,b,d){aux=$("#tabelaTrocas");aux.append("<tbody>");a.forEach(function(a){for(var e=0,k,c=0;c<b.length;c++)b[c].proponente===a&&(e+=1,e>d&&alert("O operador "+b[c].proponente+" possui mais que "+d+" trocas"),k=moment(b[c].dataRegistro).format("DD/MM"),aux.append("<tr id='linhaTabelaTroca-"+c+"'><td>"+b[c].proponente+"</td><td>"+e+"</td><td>"+b[c].diaProponente+"-"+b[c].turnoProponente+"</td><td>"+b[c].proposto+"</td><td>"+b[c].diaProposto+"-"+b[c].turnoProposto+
"</td><td>"+k+"</td><td><button type='button' name='deletarRegistro-"+c+"' class='btn btn-danger btn-sm btn-deletar' id='deletarRegistro-"+c+"'><i class='fa fa-trash' aria-hidden='true'></i></button></td></tr>"))});aux.append("</tbody>");$(".btn-deletar").on("click",function(){indice=$(this).attr("id").split("-")[1];b.splice(indice,1);alert("Troca deletada!");$("#tabelaTrocas tbody").remove();t(a,b,d)})}function D(a,b){var d=0;a.forEach(function(a){for(var e="("+f[a].etapasComuns.length+") / ",g=
"("+f[a].etapasEventuais.length+") / ",c=0;c<f[a].etapasComuns.length;c++)e+=f[a].etapasComuns[c]+", ";for(c=0;c<f[a].etapasEventuais.length;c++)g+=f[a].etapasEventuais[c]+", ";$("#operador"+a+"-cargaHoraria").html(f[a].cargaHoraria+" horas");$("#operador"+a+"-etapaComum").html(e);$("#operador"+a+"-etapaEventual").html(g);f[a].cargaHoraria<b&&0<f[a].cargaHoraria&&($("#linhaTabelaCargaOperadores-"+a).addClass("danger"),d+=1);f[a].cargaHoraria>b&&$("#linhaTabelaCargaOperadores-"+a).addClass("success")});
0<d&&($("#corpoPainelAvisoCargaHoraria").html("Aconteceu algum problema. H\u00e1 "+d+" operador(es) abaixo da carga hor\u00e1ria m\u00ednima."),$("#painelAvisoCargaHoraria").show())}function E(){$("input[class='smallinput inputUsuario form-control']").each(function(){var a=$(this).attr("id").split("-"),a=m[a[0]][a[1]][a[2]];$(this).val(a)})}var h="ABCDEFGHIJKLMNOPQRST".split(""),m=[],p=[],f=[],d={numeroDias:31,numeroTurnos:3,numeroOperadoresPorTurno:5,digitosLegendas:1,cargaHorariaDiurna:7.25,cargaHorariaNoturna:10.25,
quantidadeTrocas:6,cargaHorariaMinima:144,removerEtapasComuns:"true"};Number.isInteger=Number.isInteger||function(a){return"number"===typeof a&&isFinite(a)&&Math.floor(a)===a};w(h);$("#botaoConfigurarAmbiente").on("click",function(){var a=-1,b=$("#inputLegendaOperadores").val();h=JSON.parse("["+b+"]");var b=$("#inputNumeroDias").val(),g=$("#inputNumeroTurnos").val(),k=$("#inputNumeroOperadoresPorTurno").val(),e=$("#inputDigitosLegendas").val(),l=$("#inputCargaHorariaDiurna").val(),c=$("#inputCargaHorariaNoturna").val(),
f=$("#inputNumeroTrocas").val(),m=$("#inputCargaHorariaMinima").val(),p=$("#inputRemoverEtapasComuns").val(),b=parseInt(b,10),g=parseInt(g,10),k=parseInt(k,10),e=parseInt(e,10),l=parseFloat(l),c=parseFloat(c),f=parseInt(f,10),m=parseFloat(m),q=n(b,"int",28,31,"n\u00famero de dias"),r=n(g,"int",3,3,"n\u00famero de turnos"),t=n(k,"int",2,20,"n\u00famero de operadores"),u=n(e,"int",1,3,"d\u00edgitos das legendas"),v=n(l,"float",0,24,"carga hor\u00e1ria diurna"),x=n(c,"float",0,24,"carga hor\u00e1ria noturna"),
y=n(f,"int",1,99,"quantidade trocas"),m=n(m,"float",100,170,"carga hor\u00e1ria m\u00ednima");1===q&&1===r&&1===t&&1===u&&1===v&&1===x&&1===y&&1===m&&(a=1);1===a&&(d.numeroDias=b,d.numeroTurnos=g,d.numeroOperadoresPorTurno=k,d.digitosLegendas=e,d.cargaHorariaDiurna=l,d.cargaHorariaNoturna=c,d.quantidadeTrocas=f,d.removerEtapasComuns=p,w(h),z(d.numeroDias,d.numeroTurnos,d.numeroOperadoresPorTurno,d.digitosLegendas),B(h,d.numeroDias),A(h),$("#paginaInsercoes").show(),$("#call-to-action").hide(),$("#paginaConfiguracoes").hide(),
$("body").scrollTop(0))});$("#botaoCarregarValores").on("click",function(){m=arrayTabelaDiasSalvo;d=configuracaoSalvo;h=legendasOperadoresSalvo;p=arrayRegistroTrocasSalvo;alert("Cuidado ao utilizar essa fun\u00e7\u00e3o. Tenha certeza que os valores configurados s\u00e3o os que voc\u00ea espera.");w(h);z(d.numeroDias,d.numeroTurnos,d.numeroOperadoresPorTurno,d.digitosLegendas);B(h,d.numeroDias);A(h);E();$("#paginaInsercoes").show();$("#call-to-action").hide();$("#paginaConfiguracoes").hide();$("body").scrollTop(0)});
$("#botaoRegistrarTroca").on("click",function(){formularioCorreto=-1;proponente=$("#inputProponente").val();proposto=$("#inputProposto").val();diaProponente=$("#inputDiaProponente").val();diaProposto=$("#inputDiaProposto").val();turnoProponente=$("#inputTurnoProponente").val();turnoProposto=$("#inputTurnoProposto").val();a:{var a=proponente,b=proposto,d=diaProponente,k=diaProposto,e=turnoProponente,f=turnoProposto,c=p;if(""===a||""===b||""===d||""===k||""===e||""===f)alert("Todos os campos precisam ser preenchidos"),
formularioCorreto=-1;else if(a===b)alert("O proponente n\u00e3o pode ser o mesmo que o proposto"),formularioCorreto=-1;else if(d===k&&e===f)alert("A troca precisa ser feita entre turnos distintos"),formularioCorreto=-1;else{for(var h=0;h<c.length;h++)if(c[h].proponente===a&&c[h].proposto===b&&c[h].diaProponente===d&&c[h].diaProposto===k&&c[h].turnoProponente===e&&c[h].turnoProposto===f){alert("Esta troca j\u00e1 foi registrada");formularioCorreto=-1;break a}formularioCorreto=1}}1===formularioCorreto&&
(a=p,b=proponente,d=proposto,k=diaProponente,e=diaProposto,f=turnoProponente,c=turnoProposto,h=moment(),b=new u(b,d,k,e,f,c,h),a.push(b),alert("Troca registrada"),$("#inputProponente").val(""),$("#inputProposto").val(""),$("#inputDiaProponente").val(""),$("#inputDiaProposto").val(""),$("#inputTurnoProponente").val(""),$("#inputTurnoProposto").val(""))});$("#botaoCalcular").on("click",function(){$("#tabelaCargaHoraria td").removeClass("danger");1===r(h,d.numeroDias,d.numeroTurnos,d.numeroOperadoresPorTurno)&&
(q(h),C(h,d.numeroDias,d.numeroTurnos,d.numeroOperadoresPorTurno),x(h,d.cargaHorariaDiurna,d.cargaHorariaNoturna),"true"===d.removerEtapasComuns&&y(h),D(h,d.cargaHorariaMinima),$("#divCargaOperadores").show(),$("#paginaInsercoes").hide(),$("body").scrollTop(0))});$("#botaoAcompanharTrocas").on("click",function(){t(h,p,d.quantidadeTrocas);0===p.length?$("#painelAvisoTrocas").show():$("#painelAvisoTrocas").hide();$("#divTabelaTrocas").show();$("#paginaInsercoes").hide();$("body").scrollTop(0)});$("#botaoMostrarTabela").on("click",
function(){q(h);$("#paginaInsercoes").show();$("#divCargaOperadores").hide();$("#tabelaCargaOperadores tr").removeClass("danger");$("#corpoPainelAvisoCargaHoraria").html("");$("#painelAvisoCargaHoraria").hide();$("body").scrollTop(0)});$("#botaoMostrarTabela2").on("click",function(){$("#tabelaTrocas tbody").remove();$("#paginaInsercoes").show();$("#divTabelaTrocas").hide();$("body").scrollTop(0)});$("#botaoSalvarValores").on("click",function(){var a=-1,a=r(h,d.numeroDias,d.numeroTurnos,d.numeroOperadoresPorTurno);
1===a&&(a="text/json;charset=utf-8, arrayTabelaDiasSalvo = "+encodeURIComponent(JSON.stringify(m))+"; configuracaoSalvo = "+encodeURIComponent(JSON.stringify(d))+"; legendasOperadoresSalvo = "+encodeURIComponent(JSON.stringify(h))+"; arrayRegistroTrocasSalvo = "+encodeURIComponent(JSON.stringify(p))+";",$("#botaoSalvarValores").hide(),$("#botaoSalvarValores").after('<a class="btn btn-success" id="botaoDownloadDados" href="data:'+a+'" download="dados.json">Download <i class="fa fa-download" aria-hidden="true"></i></a>'),
$("#botaoDownloadDados").on("click",function(){$("#botaoDownloadDados").remove();$("#botaoSalvarValores").show()}))});$("#paragrafoConfiguracoes").on("click",function(){if($("#configuracoesAvancadas").hasClass("inativo"))return $("#configuracoesAvancadas").fadeIn(600),$("#paragrafoConfiguracoes").html("<p id='paragrafoConfiguracoes'>Configura\u00e7\u00f5es Avan\u00e7adas <i class='fa fa-caret-up' aria-hidden='true'></i></p>"),$("#configuracoesAvancadas").removeClass("inativo").addClass("ativo"),1;
if($("#configuracoesAvancadas").hasClass("ativo"))return $("#configuracoesAvancadas").fadeOut(200),$("#paragrafoConfiguracoes").html("<p id='paragrafoConfiguracoes'>Configura\u00e7\u00f5es Avan\u00e7adas <i class='fa fa-caret-down' aria-hidden='true'></i></p>"),$("#configuracoesAvancadas").removeClass("ativo").addClass("inativo"),1})});