$(document).ready(function(){function r(a,d,m,h,g){if("int"===d){if(isNaN(a))return alert("O valor de "+g+" precisa ser um n\u00famero"),-1;if(!Number.isInteger(a))return alert("O valor de "+g+" precisa ser um n\u00famero inteiro"),-1}return"float"===d&&isNaN(a)?(alert("O valor de "+g+" precisa ser um n\u00famero"),-1):a<m||a>h?(alert("O valor de "+g+" precisa ser um n\u00famero entre "+m+" e "+h),-1):1}function w(a,d,m,h,g,f){for(var c=1;c<=m;c++)for(var b=1;b<=h;b++)for(var l=1;l<=g;l++){var e=
a[c][b][l];if(-1===d.indexOf(e)&&""!==e)return alert("Voc\u00ea inseriu um usu\u00e1rio n\u00e3o cadastrado no dia "+c),$("#linhaTurno"+c+b).addClass("danger"),-1}for(c=1;c<=m;c++)for(b=1;b<=h;b++)for(l=1;l<=g;l++)if(e=a[c][b][l],""!==e)for(d=l+1;d<=g;d++){var k=a[c][b][d];if(k===e)return f?alert("A troca n\u00e3o pode ser efetuada devido \u00e0 um choque de turnos"):(alert("Voc\u00ea inseriu a legenda "+e+" mais de uma vez no dia "+c),$("#linhaTurno"+c+b).addClass("danger")),-1}for(c=1;c<=m;c++)for(b=
1;b<=h;b++)for(l=1;l<=g;l++)if(e=a[c][b][l],""!==e)for(d=1;d<=g;d++){var q=b+1;if(4===q){if(q=c+1,k=a[q][1][d],k===e)return f?alert("A troca n\u00e3o pode ser efetuada devido \u00e0 um choque de turnos"):(alert("Voc\u00ea inseriu a legenda "+e+" em turnos ajacentes"),$("#linhaTurno"+c+b).addClass("danger"),$("#linhaTurno"+q+1).addClass("danger")),-1}else if(k=a[c][q][d],k===e)if(f)alert("A troca n\u00e3o pode ser efetuada devido \u00e0 um choque de turnos");else return alert("Voc\u00ea inseriu a legenda "+
e+" em turnos ajacentes"),$("#linhaTurno"+c+b).addClass("danger"),$("#linhaTurno"+c+q).addClass("danger"),-1}return 1}function z(a,d,b,h){var g=$("#tabelaCargaHoraria");g.append("<tbody>");for(var f=1;f<a+1;f++){g.append("<tr><td id='linhaDia"+f+"'>Dia "+f+"</td></tr>");for(var c=d;0<c;c--){$("#linhaDia"+f).after("<td id='linhaTurno"+f+c+"'></td>");for(var m=1;m<b+1;m++)$("#linhaTurno"+f+c).append("<input type='text' class='smallinput inputUsuario form-control' maxlength='"+h+"' id='"+f+"-"+c+"-"+
m+"'>")}}g.append("</tbody>")}function A(a){aux=$("#tabelaCargaOperadores");aux.append("<tbody>");a.forEach(function(a){aux.append("<tr id='linhaTabelaCargaOperadores-"+a+"'><td>"+a+"</td><td><span id='operador"+a+"-cargaHoraria'></span></td><td><span id='operador"+a+"-etapaComum'></span></td><td><span id='operador"+a+"-etapaEventual'></span></td></tr>")});aux.append("</tbody>")}function B(a,d){inputProponente=$("#inputProponente");inputProposto=$("#inputProposto");inputDiaProponente=$("#inputDiaProponente");
inputDiaProposto=$("#inputDiaProposto");a.forEach(function(a){inputProponente.append("<option value='"+a+"'>"+a+"</option>");inputProposto.append("<option value='"+a+"'>"+a+"</option>")});for(var b=1;b<=d;b++)inputDiaProponente.append("<option value='"+b+"'>"+b+"</option>"),inputDiaProposto.append("<option value='"+b+"'>"+b+"</option>")}function F(a,b,m,h,g,f,c){this.proponente=a;this.proposto=b;this.diaProponente=m;this.diaProposto=h;this.turnoProponente=g;this.turnoProposto=f;this.dataRegistro=
c}function G(a,b,m){this.cargaHoraria=a;this.etapasComuns=b;this.etapasEventuais=m}function x(a){a.forEach(function(a){e[a]=new G(0,[],[])})}function C(a){a.forEach(function(a){e[a].cargaHoraria=0;e[a].etapasComuns=[];e[a].etapasEventuais=[]})}function D(a,d,m,h,g,f,c,e,l){var v,r;a=JSON.parse(JSON.stringify(a));var q=-1,u=!1;"M"===f&&(f=1);"T"===f&&(f=2);"N"===f&&(f=3);"M"===c&&(c=1);"T"===c&&(c=2);"N"===c&&(c=3);h=parseInt(h,10);g=parseInt(g,10);for(var n=1;n<=e;n++)if(a[h][f][n]===d&&(v=n,u=!0),
n===e&&!u&&l)return alert("Proponente n\u00e3o encontrado no turno informado"),1;u=!1;for(n=1;n<=e;n++)if(a[g][c][n]===m&&(r=n,u=!0),n===e&&!u&&l)return alert("Proposto n\u00e3o encontrado no turno informado"),1;a[h][f][v]=m;a[g][c][r]=d;l&&(q=w(a,k,b.numeroDias,b.numeroTurnos,b.numeroOperadoresPorTurno,!0));l||(p=JSON.parse(JSON.stringify(a)),$("#"+h+"-"+f+"-"+v).val(m),$("#"+g+"-"+c+"-"+r).val(d),q=1);return q}function y(a,b,m){for(var h=1;h<=a;h++){p[h]=[];for(var d=1;d<=b;d++){p[h][d]=[];for(var f=
1;f<=m;f++)p[h][d][f]=$("#"+h+"-"+d+"-"+f).val()}}return 1}function H(a,b,m){a.forEach(function(a){var d;d=e[a].etapasComuns.length*b;d+=e[a].etapasEventuais.length*m;0>d&&alert("Aconteceu algum problema inesperado na contagem de carga do operador "+a+". Contacte o Schuler e pare de utilizar o programa enquanto o problema n\u00e3o for resolvido.");e[a].cargaHoraria=d})}function I(a){a.forEach(function(a){for(var b,d=0;d<e[a].etapasEventuais.length;d++)b=e[a].etapasComuns.indexOf(e[a].etapasEventuais[d]),
-1!=b&&e[a].etapasComuns.splice(b,1)})}function J(a,b,m,h){a.forEach(function(a){for(var d=1;d<=b;d++)for(var c=1;c<=m;c++)for(var g=1;g<=h;g++)valorCelula=p[d][c][g],""!==valorCelula&&valorCelula==a&&(1!=c&&2!=c||e[a].etapasComuns.push(d),3==c&&e[a].etapasEventuais.push(d))})}function E(a,b,e){aux=$("#tabelaTrocas");aux.append("<tbody>");a.forEach(function(a){for(var d=0,h,c=0;c<b.length;c++)b[c].proponente===a&&(d+=1,d>e&&alert("O operador "+b[c].proponente+" possui mais que "+e+" trocas"),h=moment(b[c].dataRegistro).format("DD/MM"),
aux.append("<tr id='linhaTabelaTroca-"+c+"'><td>"+b[c].proponente+"</td><td>"+d+"</td><td>"+b[c].diaProponente+"-"+b[c].turnoProponente+"</td><td>"+b[c].proposto+"</td><td>"+b[c].diaProposto+"-"+b[c].turnoProposto+"</td><td>"+h+"</td><td><button type='button' name='deletarRegistro-"+c+"' class='btn btn-danger btn-sm btn-deletar' id='deletarRegistro-"+c+"'><i class='fa fa-trash' aria-hidden='true'></i></button></td></tr>"))});aux.append("</tbody>");$(".btn-deletar").on("click",function(){indice=$(this).attr("id").split("-")[1];
b.splice(indice,1);alert("Troca deletada!");$("#tabelaTrocas tbody").remove();E(a,b,e)})}function K(a,b){var d=0;a.forEach(function(a){for(var g="("+e[a].etapasComuns.length+") / ",f="("+e[a].etapasEventuais.length+") / ",c=0;c<e[a].etapasComuns.length;c++)g+=e[a].etapasComuns[c]+", ";for(c=0;c<e[a].etapasEventuais.length;c++)f+=e[a].etapasEventuais[c]+", ";$("#operador"+a+"-cargaHoraria").html(e[a].cargaHoraria+" horas");$("#operador"+a+"-etapaComum").html(g);$("#operador"+a+"-etapaEventual").html(f);
e[a].cargaHoraria<b&&0<e[a].cargaHoraria&&($("#linhaTabelaCargaOperadores-"+a).addClass("danger"),d+=1);e[a].cargaHoraria>b&&$("#linhaTabelaCargaOperadores-"+a).addClass("success")});0<d&&($("#corpoPainelAvisoCargaHoraria").html("Aconteceu algum problema. H\u00e1 "+d+" operador(es) abaixo da carga hor\u00e1ria m\u00ednima."),$("#painelAvisoCargaHoraria").show())}function L(){$("input[class='smallinput inputUsuario form-control']").each(function(){var a=$(this).attr("id").split("-"),a=p[a[0]][a[1]][a[2]];
$(this).val(a)})}var k="ABCDEFGHIJKLMNOPQRST".split(""),p=[],t=[],e=[],b={numeroDias:31,numeroTurnos:3,numeroOperadoresPorTurno:5,digitosLegendas:1,cargaHorariaDiurna:7.25,cargaHorariaNoturna:10.25,quantidadeTrocas:6,cargaHorariaMinima:144,removerEtapasComuns:"true"};Number.isInteger=Number.isInteger||function(a){return"number"===typeof a&&isFinite(a)&&Math.floor(a)===a};x(k);$("#botaoConfigurarAmbiente").on("click",function(){var a=$("#inputLegendaOperadores").val();k=JSON.parse("["+a+"]");var a=
parseFloat($("#inputNumeroDias").val()),d=parseFloat($("#inputNumeroOperadoresPorTurno").val()),e=parseFloat($("#inputDigitosLegendas").val()),h=parseFloat($("#inputCargaHorariaDiurna").val()),g=parseFloat($("#inputCargaHorariaNoturna").val()),f=parseFloat($("#inputNumeroTrocas").val()),c=parseFloat($("#inputCargaHorariaMinima").val()),v=$("#inputRemoverEtapasComuns").val();var l=r(a,"int",28,31,"n\u00famero de dias"),p=r(d,"int",2,20,"n\u00famero de operadores"),t=r(e,"int",1,3,"d\u00edgitos das legendas"),
q=r(h,"float",0,24,"carga hor\u00e1ria diurna"),u=r(g,"float",0,24,"carga hor\u00e1ria noturna"),n=r(f,"int",1,99,"quantidade trocas"),c=r(c,"float",100,170,"carga hor\u00e1ria m\u00ednima");1===(1===l&&1===p&&1===t&&1===q&&1===u&&1===n&&1===c?1:-1)&&(b.numeroDias=a,b.numeroTurnos=3,b.numeroOperadoresPorTurno=d,b.digitosLegendas=e,b.cargaHorariaDiurna=h,b.cargaHorariaNoturna=g,b.quantidadeTrocas=f,b.removerEtapasComuns=v,x(k),z(b.numeroDias,b.numeroTurnos,b.numeroOperadoresPorTurno,b.digitosLegendas),
B(k,b.numeroDias),A(k),$("#paginaInsercoes").show(),$("#call-to-action").hide(),$("#paginaConfiguracoes").hide(),$("body").scrollTop(0))});$("#botaoCarregarValores").on("click",function(){p=arrayTabelaDiasSalvo;b=configuracaoSalvo;k=legendasOperadoresSalvo;t=arrayRegistroTrocasSalvo;alert("Cuidado ao utilizar essa fun\u00e7\u00e3o. Tenha certeza que os valores configurados s\u00e3o os que voc\u00ea espera.");x(k);z(b.numeroDias,b.numeroTurnos,b.numeroOperadoresPorTurno,b.digitosLegendas);B(k,b.numeroDias);
A(k);L();$("#paginaInsercoes").show();$("#call-to-action").hide();$("#paginaConfiguracoes").hide();$("body").scrollTop(0)});$("#botaoRegistrarTroca").on("click",function(){var a,d,e;proponente=$("#inputProponente").val();proposto=$("#inputProposto").val();diaProponente=$("#inputDiaProponente").val();diaProposto=$("#inputDiaProposto").val();turnoProponente=$("#inputTurnoProponente").val();turnoProposto=$("#inputTurnoProposto").val();y(b.numeroDias,b.numeroTurnos,b.numeroOperadoresPorTurno);e=JSON.parse(JSON.stringify(p));
a:{a=proponente;d=proposto;var h=diaProponente,g=diaProposto,f=turnoProponente,c=turnoProposto,k=t;if(""===a||""===d||""===h||""===g||""===f||""===c)alert("Todos os campos precisam ser preenchidos"),a=-1;else if(a===d)alert("O proponente n\u00e3o pode ser o mesmo que o proposto"),a=-1;else if(h===g&&f===c)alert("A troca precisa ser feita entre turnos distintos"),a=-1;else{for(var l=0;l<k.length;l++)if(k[l].proponente===a&&k[l].proposto===d&&k[l].diaProponente===h&&k[l].diaProposto===g&&k[l].turnoProponente===
f&&k[l].turnoProposto===c){alert("Esta troca j\u00e1 foi registrada");a=-1;break a}a=1}}d=D(e,proponente,proposto,diaProponente,diaProposto,turnoProponente,turnoProposto,b.numeroOperadoresPorTurno,!0);1===a&&1===d&&(a=t,d=proponente,h=proposto,g=diaProponente,f=diaProposto,c=turnoProponente,k=turnoProposto,l=moment(),d=new F(d,h,g,f,c,k,l),a.push(d),D(e,proponente,proposto,diaProponente,diaProposto,turnoProponente,turnoProposto,b.numeroOperadoresPorTurno,!1),alert("Troca registrada"),$("#inputProponente").val(""),
$("#inputProposto").val(""),$("#inputDiaProponente").val(""),$("#inputDiaProposto").val(""),$("#inputTurnoProponente").val(""),$("#inputTurnoProposto").val(""))});$("#botaoCalcular").on("click",function(){$("#tabelaCargaHoraria td").removeClass("danger");y(b.numeroDias,b.numeroTurnos,b.numeroOperadoresPorTurno);1===w(p,k,b.numeroDias,b.numeroTurnos,b.numeroOperadoresPorTurno,!1)&&(C(k),J(k,b.numeroDias,b.numeroTurnos,b.numeroOperadoresPorTurno),H(k,b.cargaHorariaDiurna,b.cargaHorariaNoturna),"true"===
b.removerEtapasComuns&&I(k),K(k,b.cargaHorariaMinima),$("#divCargaOperadores").show(),$("#paginaInsercoes").hide(),$("body").scrollTop(0))});$("#botaoAcompanharTrocas").on("click",function(){E(k,t,b.quantidadeTrocas);0===t.length?$("#painelAvisoTrocas").show():$("#painelAvisoTrocas").hide();$("#divTabelaTrocas").show();$("#paginaInsercoes").hide();$("body").scrollTop(0)});$("#botaoMostrarTabela").on("click",function(){C(k);$("#paginaInsercoes").show();$("#divCargaOperadores").hide();$("#tabelaCargaOperadores tr").removeClass("danger");
$("#corpoPainelAvisoCargaHoraria").html("");$("#painelAvisoCargaHoraria").hide();$("body").scrollTop(0)});$("#botaoMostrarTabela2").on("click",function(){$("#tabelaTrocas tbody").remove();$("#paginaInsercoes").show();$("#divTabelaTrocas").hide();$("body").scrollTop(0)});$("#botaoSalvarValores").on("click",function(){var a=-1;y(b.numeroDias,b.numeroTurnos,b.numeroOperadoresPorTurno);a=w(p,k,b.numeroDias,b.numeroTurnos,b.numeroOperadoresPorTurno);1===a&&(a="text/json;charset=utf-8, arrayTabelaDiasSalvo = "+
encodeURIComponent(JSON.stringify(p))+"; configuracaoSalvo = "+encodeURIComponent(JSON.stringify(b))+"; legendasOperadoresSalvo = "+encodeURIComponent(JSON.stringify(k))+"; arrayRegistroTrocasSalvo = "+encodeURIComponent(JSON.stringify(t))+";",$("#botaoSalvarValores").hide(),$("#botaoSalvarValores").after('<a class="btn btn-success" id="botaoDownloadDados" href="data:'+a+'" download="dados.json">Download <i class="fa fa-download" aria-hidden="true"></i></a>'),$("#botaoDownloadDados").on("click",function(){$("#botaoDownloadDados").remove();
$("#botaoSalvarValores").show()}))});$("#paragrafoConfiguracoes").on("click",function(){if($("#configuracoesAvancadas").hasClass("inativo"))return $("#configuracoesAvancadas").fadeIn(600),$("#paragrafoConfiguracoes").html("<p id='paragrafoConfiguracoes'>Configura\u00e7\u00f5es Avan\u00e7adas <i class='fa fa-caret-up' aria-hidden='true'></i></p>"),$("#configuracoesAvancadas").removeClass("inativo").addClass("ativo"),1;if($("#configuracoesAvancadas").hasClass("ativo"))return $("#configuracoesAvancadas").fadeOut(200),
$("#paragrafoConfiguracoes").html("<p id='paragrafoConfiguracoes'>Configura\u00e7\u00f5es Avan\u00e7adas <i class='fa fa-caret-down' aria-hidden='true'></i></p>"),$("#configuracoesAvancadas").removeClass("ativo").addClass("inativo"),1})});