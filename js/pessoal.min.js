$(document).ready(function(){function n(b,c,a,e){for(var d=$("#tabelaCargaHoraria"),f=1;f<b+1;f++){d.append("<tr><td id='linhaDia"+f+"'>Dia "+f+"</td></tr>");for(var h=c;0<h;h--){$("#linhaDia"+f).after("<td id='linhaTurno"+f+h+"'></td>");for(var k=1;k<a+1;k++)$("#linhaTurno"+f+h).append("<input type='text' class='smallinput inputUsuario' maxlength='"+e+"' id='"+f+"-"+h+k+"'>")}}}function p(b){aux=$("#tabelaCargaOperadores");b.forEach(function(c){aux.append("<tr><td>"+c+"</td><td><span id='operador"+
c+"-cargaHoraria'></span></td><td><span id='operador"+c+"-etapaComum'></span></td><td><span id='operador"+c+"-etapaEventual'></span></td></tr>")})}function t(b,c,a){this.cargaHoraria=b;this.etapasComuns=c;this.etapasEventuais=a}function m(b){b.forEach(function(c){e[c]=new t(0,[],[])})}function q(b){b.forEach(function(c){e[c].cargaHoraria=0;e[c].etapasComuns=[];e[c].etapasEventuais=[]})}function r(b,c,a,e){for(var d=1;d<=c;d++){l[d]=[];for(var f=1;f<=a;f++){l[d][f]=[];for(var h=1;h<=e;h++){valorCelula=
$("#"+d+"-"+f+h).val();indiceValorCelula=b.indexOf(valorCelula);if(-1==indiceValorCelula)if(""==valorCelula)continue;else alert("Voc\u00ea inseriu um usu\u00e1rio n\u00e3o cadastrado no dia "+d);l[d][f][h]=valorCelula}}}}function u(a,c,h){a.forEach(function(a){var b;b=e[a].etapasComuns.length*c;b+=e[a].etapasEventuais.length*h;e[a].cargaHoraria=b})}function v(a){a.forEach(function(c){for(var a,b=0;b<e[c].etapasEventuais.length;b++)a=e[c].etapasComuns.indexOf(e[c].etapasEventuais[b]),-1!=a&&e[c].etapasComuns.splice(a,
1)})}function w(a,c,h,g){a.forEach(function(a){for(var b=1;b<=c;b++)for(var d=1;d<=h;d++)for(var k=1;k<=g;k++)valorCelula=l[b][d][k],""!=valorCelula&&valorCelula==a&&(1!=d&&2!=d||e[a].etapasComuns.push(b),3==d&&e[a].etapasEventuais.push(b))})}function x(a){a.forEach(function(a){for(var b="("+e[a].etapasComuns.length+") / ",c="("+e[a].etapasEventuais.length+") / ",d=0;d<e[a].etapasComuns.length;d++)b+=e[a].etapasComuns[d]+", ";for(d=0;d<e[a].etapasEventuais.length;d++)c+=e[a].etapasEventuais[d]+", ";
$("#operador"+a+"-cargaHoraria").html(e[a].cargaHoraria+" horas");$("#operador"+a+"-etapaComum").html(b);$("#operador"+a+"-etapaEventual").html(c)})}function y(){$("input[class='smallinput inputUsuario']").each(function(){var a=$(this).attr("id").split("-"),c=a[1].split(""),a=l[a[0]][c[0]][c[1]];$(this).val(a)})}var g="ABCDEFGHIJKLMNOPQRST".split(""),l=[],e=[],a={numeroDias:31,numeroTurnos:3,numeroOperadoresPorTurno:5,digitosLegendas:1,cargaHorariaDiurna:7.25,cargaHorariaNoturna:10.25};m(g);$("#botaoConfigurarAmbiente").on("click",
function(){var b=$("#inputLegendaOperadores").val();g=JSON.parse("["+b+"]");var b=$("#inputNumeroDias").val(),c=$("#inputNumeroTurnos").val(),e=$("#inputNumeroOperadoresPorTurno").val(),k=$("#inputDigitosLegendas").val(),d=$("#inputCargaHorariaDiurna").val(),f=$("#inputCargaHorariaNoturna").val(),b=parseInt(b,10),c=parseInt(c,10),e=parseInt(e,10),k=parseInt(k,10),d=parseFloat(d),f=parseFloat(f);a.numeroDias=b;a.numeroTurnos=c;a.numeroOperadoresPorTurno=e;a.digitosLegendas=k;a.cargaHorariaDiurna=d;
a.cargaHorariaNoturna=f;m(g);n(a.numeroDias,a.numeroTurnos,a.numeroOperadoresPorTurno,a.digitosLegendas);p(g);$("#divTabelaCargaHoraria").show();$("#paginaConfiguracoes").hide()});$("#botaoCarregarValores").on("click",function(){l=arrayTabelaDiasSalvo;a=configuracaoSalvo;g=legendasOperadoresSalvo;alert("Cuidado ao utilizar essa fun\u00e7\u00e3o. Tenha certeza que os valores configurados s\u00e3o os que voc\u00ea espera.");m(g);n(a.numeroDias,a.numeroTurnos,a.numeroOperadoresPorTurno,a.digitosLegendas);
p(g);y();$("#divTabelaCargaHoraria").show();$("#paginaConfiguracoes").hide()});$("#botaoCalcular").on("click",function(){r(g,a.numeroDias,a.numeroTurnos,a.numeroOperadoresPorTurno);q(g);w(g,a.numeroDias,a.numeroTurnos,a.numeroOperadoresPorTurno);u(g,a.cargaHorariaDiurna,a.cargaHorariaNoturna);v(g);x(g);$("#divCargaOperadores").show();$("#divTabelaCargaHoraria").hide()});$("#botaoMostrarTabela").on("click",function(){q(g);$("#divTabelaCargaHoraria").show();$("#divCargaOperadores").hide()});$("#botaoSalvarValores").on("click",
function(){r(g,a.numeroDias,a.numeroTurnos,a.numeroOperadoresPorTurno);var b="text/json;charset=utf-8, arrayTabelaDiasSalvo = "+encodeURIComponent(JSON.stringify(l))+"; configuracaoSalvo = "+encodeURIComponent(JSON.stringify(a))+"; legendasOperadoresSalvo = "+encodeURIComponent(JSON.stringify(g))+";";$("#botaoSalvarValores").removeClass("btn btn-success");$("#botaoSalvarValores").html('<a class="btn btn-success" href="data:'+b+'" download="dados.json">Download JSON</a>')})});
